---
layout: '@/templates/BasePost.astro'
title: Ice & Fire
description: Top-down hack&slash vertical slice - Balance your temperature to stay alive.
pubDate: 2024-01-05T00:00:00Z
imgSrc: '/assets/images/image-post2.jpeg'
imgAlt: 'Cover art'
showcase: true
shields:
- Unity-UniTask_|_DOTween-57b9d3.svg?style=flat&logo=unity
- C%23-%23239120.svg?style=flat&logo=csharp&logoColor=white
- FMOD-0058D9?style=flat&logo=fmod&logoColor=#7D929E
---
import { StoreLinkBanner, ProjectDetails, EmbedVideo } from '@/partials/post-components';

Vertical slice for a distinctive top-down hack & slash game, where the focus shifts from limiting
damage taken to balancing your character's temperature and maintaining it at a stable level.

<ProjectDetails
  role='Lead Developer'
  company='N/A'
  platforms='PC'
  time='2 years'
/>

## My contributions

1. [Gameplay programming](#gameplay)
1. [Custom combat system](#combat-system)
1. Checkpoint system

## Gameplay
I'm responsible for implementing main character locomotion and abilities,
while ensuring they play well with animations and interact correctly with other systems.
- Aim assist  // TODO: import images
- Melee enemy lock  // TODO: import gif

## Combat system
**AI programming**

```
public class CustomEnemyAI : BaseEnemyAI
{
  protected override FSMState EnterState => IdleState;

  void Start()
  {
    StartFSM();
  }

  async UniTask<FSMState> IdleState(CancellationToken token)
  {
    await HTask.WaitUntil(() => Actor.CanSeePlayer, token);
    return ChaseState;
  }

  async UniTask<FSMState> ChaseState(CancellationToken token)
  {
    await HTask.RepeatUntil(
      () => Agent.SetDestination(PlayerInstance.Position),
      () => Actor.CanAttackPlayer, 
      .1f, token
      );

    return AttackState;
  }

  // ...
}
```

**UniTask FSM**
```
[RequireComponent(typeof(AEnemy))]
public abstract class BaseEnemyAI : MonoBehaviour
{
  private CancellationTokenSource interruptTokenSource;
  
  protected FSMState CurrentState;
  protected abstract FSMState EnterState { get; }
  
  public delegate UniTask<FSMState> FSMState(CancellationToken ct);

  // ...

  protected virtual void Awake()
  {
    // ...
    CurrentState = EnterState;
  }

  protected void StartFSM()
  {
    AILoop();
  }

  private async void AILoop()
  {
    interruptTokenSource = new CancellationTokenSource();
    var linkedTokenSource = CancellationTokenSource.CreateLinkedTokenSource(
      interruptTokenSource.Token, this.GetCancellationTokenOnDestroy()
      );

    try
    {
      if (logCurrentState) LogCurrentState();
      while (gameObject && gameObject.activeInHierarchy)
      {
        CurrentState = await CurrentState(linkedTokenSource.Token);
        if (logCurrentState) LogCurrentState();
      }
    }
    catch (OperationCanceledException) { }
  }

  protected void InterruptCurrentState(FSMState nextState)
  {
    interruptTokenSource.Cancel();
    OnStateInterrupted();
    CurrentState = nextState;
    AILoop();
  }

  protected virtual void OnStateInterrupted()
  {
    Agent.isStopped = false;
    Actor.SetGraphics(true);
    Actor.Root.ResetAttackData();
  }

  // ...
}
```
